CREATE DATABASE IF NOT EXISTS userManage;
USE userManage;

CREATE TABLE perfiles (
    id_perfil INT AUTO_INCREMENT PRIMARY KEY,
    nombre_perfil VARCHAR(100) NOT NULL UNIQUE,
    fecha_vigencia_perfil DATE NOT NULL,
    descripcion_perfil TEXT,
    encargado_perfil VARCHAR(200),
    estado ENUM('activo', 'inactivo') DEFAULT 'activo',
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    fecha_modificacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE usuarios (
    id_usuario INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    apellido VARCHAR(100) NOT NULL,
    estado ENUM('activo', 'inactivo') DEFAULT 'activo',
    contrasena VARCHAR(255) NOT NULL,
    cargo VARCHAR(100) NOT NULL,
    salario DECIMAL(10,2) NOT NULL,
    fecha_ingreso DATE NOT NULL,
    id_perfil INT NOT NULL,
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    fecha_modificacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (id_perfil) REFERENCES perfiles(id_perfil)
);

CREATE TABLE perfil_permisos (
    id_perfil_permiso INT AUTO_INCREMENT PRIMARY KEY,
    id_perfil INT NOT NULL,
    id_permiso INT NOT NULL,
    fecha_asignacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    estado ENUM('activo', 'inactivo') DEFAULT 'activo',
    FOREIGN KEY (id_perfil) REFERENCES perfiles(id_perfil) ON DELETE CASCADE,

    UNIQUE KEY unique_perfil_permiso (id_perfil, id_permiso)
);

CREATE TABLE login (
    id_login INT AUTO_INCREMENT PRIMARY KEY,
    id_usuario INT NOT NULL,
    fecha_hora_login TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    estado_login ENUM('exitoso', 'fallido') NOT NULL,
    FOREIGN KEY (id_usuario) REFERENCES usuarios(id_usuario)
);

CREATE TABLE actividades (
    id_actividad INT AUTO_INCREMENT PRIMARY KEY,
    fecha_actividad DATE NOT NULL,
    tipo_actividad VARCHAR(100) NOT NULL,
    descripcion_actividad TEXT,
    puntos_otorgados INT NOT NULL DEFAULT 0,
    estado ENUM('activa', 'finalizada', 'cancelada') DEFAULT 'activa',
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE participacion_actividades (
    id_participacion INT AUTO_INCREMENT PRIMARY KEY,
    id_usuario INT NOT NULL,
    id_actividad INT NOT NULL,
    puntos_obtenidos INT NOT NULL DEFAULT 0,
    fecha_participacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    observaciones TEXT,
    FOREIGN KEY (id_usuario) REFERENCES usuarios(id_usuario),
    FOREIGN KEY (id_actividad) REFERENCES actividades(id_actividad),

    UNIQUE KEY unique_usuario_actividad (id_usuario, id_actividad)
);

CREATE TABLE fidelizacion (
    id_fidelizacion INT AUTO_INCREMENT PRIMARY KEY,
    id_usuario INT NOT NULL,
    id_perfil INT NOT NULL,
    total_puntos INT NOT NULL DEFAULT 0,
    estatus_fidelizacion VARCHAR(50) DEFAULT 'Bronce',
    fecha_ultima_actualizacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (id_usuario) REFERENCES usuarios(id_usuario),
    FOREIGN KEY (id_perfil) REFERENCES perfiles(id_perfil),

    UNIQUE KEY unique_usuario_fidelizacion (id_usuario)
);

INSERT INTO perfiles (id_perfil, nombre_perfil, fecha_vigencia_perfil, descripcion_perfil, encargado_perfil, estado) VALUES
(1, 'Perfil_1', '2026-06-12', 'Descripción del perfil 1', 'Encargado 1', 'activo'),
(2, 'Perfil_2', '2026-06-12', 'Descripción del perfil 2', 'Encargado 2', 'activo'),
(3, 'Perfil_3', '2026-06-12', 'Descripción del perfil 3', 'Encargado 3', 'activo'),
(4, 'Perfil_4', '2026-06-12', 'Descripción del perfil 4', 'Encargado 4', 'activo'),
(5, 'Perfil_5', '2026-06-12', 'Descripción del perfil 5', 'Encargado 5', 'activo'),
(6, 'Perfil_6', '2026-06-12', 'Descripción del perfil 6', 'Encargado 6', 'activo'),
(7, 'Perfil_7', '2026-06-12', 'Descripción del perfil 7', 'Encargado 7', 'activo'),
(8, 'Perfil_8', '2026-06-12', 'Descripción del perfil 8', 'Encargado 8', 'activo'),
(9, 'Perfil_9', '2026-06-12', 'Descripción del perfil 9', 'Encargado 9', 'activo'),
(10, 'Perfil_10', '2026-06-12', 'Descripción del perfil 10', 'Encargado 10', 'activo');

INSERT INTO usuarios (id_usuario, nombre, apellido, estado, contrasena, cargo, salario, fecha_ingreso, id_perfil) VALUES
(1, 'Luis', 'Pérez', 'activo', 'pass1', 'Empleado', 4224.65, '2025-01-08', 4),
(2, 'Carlos', 'Gómez', 'activo', 'pass2', 'Empleado', 4030.1, '2024-08-07', 2),
(3, 'Martín', 'Romero', 'activo', 'pass3', 'Empleado', 2095.35, '2025-03-27', 4),
(4, 'María', 'Torres', 'activo', 'pass4', 'Empleado', 3806.06, '2024-07-30', 4),
(5, 'Sofía', 'Romero', 'activo', 'pass5', 'Empleado', 2661.32, '2024-07-16', 5),
(6, 'Ana', 'Rodríguez', 'activo', 'pass6', 'Empleado', 4094.42, '2024-11-20', 5),
(7, 'Carlos', 'López', 'activo', 'pass7', 'Empleado', 4871.64, '2024-11-22', 2),
(8, 'Luis', 'Romero', 'activo', 'pass8', 'Empleado', 2290.15, '2024-11-18', 10),
(9, 'Elena', 'Pérez', 'activo', 'pass9', 'Empleado', 4189.2, '2024-08-12', 2),
(10, 'Laura', 'Gómez', 'activo', 'pass10', 'Empleado', 3656.12, '2024-06-26', 10),
(11, 'Pedro', 'Castro', 'activo', 'pass11', 'Empleado', 2576.87, '2025-04-08', 1),
(12, 'María', 'Hernández', 'activo', 'pass12', 'Empleado', 4955.66, '2025-01-14', 2),
(13, 'Laura', 'Hernández', 'activo', 'pass13', 'Empleado', 3360.23, '2024-11-08', 3),
(14, 'Pedro', 'Díaz', 'activo', 'pass14', 'Empleado', 2628.52, '2024-12-28', 2),
(15, 'Martín', 'Rodríguez', 'activo', 'pass15', 'Empleado', 3602.42, '2025-01-08', 3),
(16, 'Jorge', 'Romero', 'activo', 'pass16', 'Empleado', 2809.84, '2024-06-20', 9),
(17, 'María', 'Díaz', 'activo', 'pass17', 'Empleado', 4528.56, '2025-04-15', 4),
(18, 'Ana', 'Díaz', 'activo', 'pass18', 'Empleado', 3203.49, '2025-04-10', 4),
(19, 'Martín', 'Díaz', 'activo', 'pass19', 'Empleado', 2637.88, '2024-08-31', 7),
(20, 'Jorge', 'Rodríguez', 'activo', 'pass20', 'Empleado', 2794.64, '2025-01-07', 9);

INSERT INTO login (id_login, id_usuario, fecha_hora_login, estado_login) VALUES
(1, 18, '2025-01-29 16:36:04', 'fallido'),
(2, 19, '2024-11-20 16:36:04', 'fallido'),
(3, 8, '2025-04-03 16:36:04', 'fallido'),
(4, 3, '2025-05-19 16:36:04', 'exitoso'),
(5, 5, '2024-07-26 16:36:04', 'exitoso'),
(6, 14, '2024-08-11 16:36:04', 'exitoso'),
(7, 13, '2024-11-29 16:36:04', 'fallido'),
(8, 17, '2025-02-04 16:36:04', 'exitoso'),
(9, 4, '2024-06-28 16:36:04', 'fallido'),
(10, 11, '2025-04-16 16:36:04', 'fallido'),
(11, 14, '2025-03-24 16:36:04', 'fallido'),
(12, 1, '2025-01-29 16:36:04', 'exitoso'),
(13, 17, '2025-04-19 16:36:04', 'fallido'),
(14, 17, '2024-08-05 16:36:04', 'exitoso'),
(15, 5, '2024-12-03 16:36:04', 'exitoso'),
(16, 18, '2024-09-14 16:36:04', 'exitoso'),
(17, 20, '2024-12-29 16:36:04', 'fallido'),
(18, 1, '2025-04-16 16:36:04', 'fallido'),
(19, 10, '2025-02-10 16:36:04', 'exitoso'),
(20, 8, '2024-08-26 16:36:04', 'exitoso'),
(21, 3, '2024-10-07 16:36:04', 'exitoso'),
(22, 18, '2025-04-09 16:36:04', 'exitoso'),
(23, 16, '2024-09-04 16:36:04', 'exitoso'),
(24, 9, '2024-09-15 16:36:04', 'fallido'),
(25, 7, '2024-09-09 16:36:04', 'exitoso'),
(26, 10, '2024-11-20 16:36:04', 'fallido'),
(27, 15, '2024-09-21 16:36:04', 'fallido'),
(28, 4, '2025-02-06 16:36:04', 'exitoso'),
(29, 3, '2024-12-21 16:36:04', 'exitoso'),
(30, 19, '2024-09-02 16:36:04', 'exitoso'),
(31, 19, '2025-02-20 16:36:04', 'exitoso'),
(32, 3, '2024-06-15 16:36:04', 'exitoso'),
(33, 8, '2025-05-09 16:36:04', 'exitoso'),
(34, 11, '2025-05-07 16:36:04', 'exitoso'),
(35, 9, '2024-07-05 16:36:04', 'fallido'),
(36, 7, '2024-09-09 16:36:04', 'exitoso'),
(37, 19, '2024-08-21 16:36:04', 'fallido'),
(38, 8, '2024-10-13 16:36:04', 'fallido'),
(39, 7, '2025-04-25 16:36:04', 'exitoso'),
(40, 14, '2024-12-13 16:36:04', 'fallido'),
(41, 14, '2024-10-16 16:36:04', 'exitoso'),
(42, 4, '2025-05-12 16:36:04', 'fallido'),
(43, 11, '2025-04-18 16:36:04', 'exitoso'),
(44, 7, '2025-03-07 16:36:04', 'fallido'),
(45, 5, '2024-11-08 16:36:04', 'exitoso'),
(46, 9, '2024-10-19 16:36:04', 'exitoso'),
(47, 3, '2024-10-29 16:36:04', 'exitoso'),
(48, 2, '2024-07-14 16:36:04', 'exitoso'),
(49, 3, '2025-02-11 16:36:04', 'exitoso'),
(50, 14, '2024-10-07 16:36:04', 'fallido'),
(51, 7, '2024-11-19 16:36:04', 'exitoso'),
(52, 6, '2024-11-30 16:36:04', 'exitoso'),
(53, 13, '2025-01-28 16:36:04', 'fallido'),
(54, 10, '2024-11-08 16:36:04', 'fallido'),
(55, 5, '2025-03-07 16:36:04', 'fallido'),
(56, 7, '2025-05-14 16:36:04', 'exitoso'),
(57, 11, '2025-05-14 16:36:04', 'exitoso'),
(58, 19, '2024-10-11 16:36:04', 'exitoso'),
(59, 2, '2024-09-25 16:36:04', 'exitoso'),
(60, 6, '2025-05-08 16:36:04', 'exitoso'),
(61, 8, '2024-11-18 16:36:04', 'exitoso'),
(62, 19, '2025-02-06 16:36:04', 'exitoso'),
(63, 20, '2025-05-02 16:36:04', 'fallido'),
(64, 19, '2024-08-27 16:36:04', 'fallido'),
(65, 9, '2025-02-28 16:36:04', 'fallido'),
(66, 8, '2025-01-28 16:36:04', 'fallido'),
(67, 5, '2024-07-04 16:36:04', 'fallido'),
(68, 15, '2025-01-02 16:36:04', 'exitoso'),
(69, 1, '2024-10-21 16:36:04', 'exitoso'),
(70, 3, '2024-09-10 16:36:04', 'exitoso'),
(71, 17, '2025-01-28 16:36:04', 'exitoso'),
(72, 12, '2025-05-08 16:36:04', 'exitoso'),
(73, 12, '2025-01-18 16:36:04', 'exitoso'),
(74, 15, '2024-09-07 16:36:04', 'fallido'),
(75, 20, '2024-07-13 16:36:04', 'exitoso'),
(76, 18, '2025-01-10 16:36:04', 'exitoso'),
(77, 5, '2025-01-28 16:36:04', 'exitoso'),
(78, 4, '2024-09-02 16:36:04', 'exitoso'),
(79, 9, '2025-01-19 16:36:04', 'exitoso'),
(80, 11, '2025-02-28 16:36:04', 'fallido'),
(81, 17, '2024-10-05 16:36:04', 'fallido'),
(82, 2, '2025-04-26 16:36:04', 'fallido'),
(83, 9, '2025-05-21 16:36:04', 'exitoso'),
(84, 11, '2025-04-07 16:36:04', 'fallido'),
(85, 6, '2024-10-29 16:36:04', 'fallido'),
(86, 18, '2025-06-08 16:36:04', 'exitoso'),
(87, 3, '2024-06-24 16:36:04', 'exitoso'),
(88, 18, '2025-05-25 16:36:04', 'fallido'),
(89, 19, '2024-09-03 16:36:04', 'exitoso'),
(90, 14, '2025-04-08 16:36:04', 'exitoso'),
(91, 10, '2024-12-08 16:36:04', 'exitoso'),
(92, 12, '2025-02-25 16:36:04', 'exitoso'),
(93, 4, '2024-12-13 16:36:04', 'fallido'),
(94, 20, '2025-03-25 16:36:04', 'exitoso'),
(95, 6, '2025-03-14 16:36:04', 'fallido'),
(96, 1, '2025-03-13 16:36:04', 'fallido'),
(97, 14, '2024-07-05 16:36:04', 'exitoso'),
(98, 9, '2025-03-23 16:36:04', 'exitoso'),
(99, 13, '2025-05-24 16:36:04', 'fallido'),
(100, 8, '2025-03-02 16:36:04', 'fallido');

INSERT INTO actividades (id_actividad, fecha_actividad, tipo_actividad, descripcion_actividad, puntos_otorgados, estado) VALUES
(1, '2024-06-01', 'Deporte', 'Actividad del mes 1, tipo 1', 14, 'finalizada'),
(2, '2024-06-11', 'Conferencia', 'Actividad del mes 1, tipo 2', 12, 'finalizada'),
(3, '2024-07-01', 'Taller', 'Actividad del mes 2, tipo 1', 11, 'finalizada'),
(4, '2024-07-11', 'Voluntariado', 'Actividad del mes 2, tipo 2', 15, 'finalizada'),
(5, '2024-07-31', 'Deporte', 'Actividad del mes 3, tipo 1', 7, 'finalizada'),
(6, '2024-08-10', 'Deporte', 'Actividad del mes 3, tipo 2', 16, 'finalizada'),
(7, '2024-08-30', 'Voluntariado', 'Actividad del mes 4, tipo 1', 15, 'finalizada'),
(8, '2024-09-09', 'Taller', 'Actividad del mes 4, tipo 2', 8, 'finalizada'),
(9, '2024-09-29', 'Deporte', 'Actividad del mes 5, tipo 1', 10, 'finalizada'),
(10, '2024-10-09', 'Deporte', 'Actividad del mes 5, tipo 2', 6, 'finalizada'),
(11, '2024-10-29', 'Taller', 'Actividad del mes 6, tipo 1', 18, 'finalizada'),
(12, '2024-11-08', 'Deporte', 'Actividad del mes 6, tipo 2', 15, 'finalizada'),
(13, '2024-11-28', 'Voluntariado', 'Actividad del mes 7, tipo 1', 8, 'finalizada'),
(14, '2024-12-08', 'Voluntariado', 'Actividad del mes 7, tipo 2', 11, 'finalizada'),
(15, '2024-12-28', 'Deporte', 'Actividad del mes 8, tipo 1', 6, 'finalizada'),
(16, '2025-01-07', 'Voluntariado', 'Actividad del mes 8, tipo 2', 5, 'finalizada'),
(17, '2025-01-27', 'Conferencia', 'Actividad del mes 9, tipo 1', 16, 'finalizada'),
(18, '2025-02-06', 'Voluntariado', 'Actividad del mes 9, tipo 2', 7, 'finalizada'),
(19, '2025-02-26', 'Deporte', 'Actividad del mes 10, tipo 1', 15, 'finalizada'),
(20, '2025-03-08', 'Taller', 'Actividad del mes 10, tipo 2', 14, 'finalizada'),
(21, '2025-03-28', 'Deporte', 'Actividad del mes 11, tipo 1', 18, 'finalizada'),
(22, '2025-04-07', 'Deporte', 'Actividad del mes 11, tipo 2', 17, 'finalizada'),
(23, '2025-04-27', 'Deporte', 'Actividad del mes 12, tipo 1', 9, 'finalizada'),
(24, '2025-05-07', 'Conferencia', 'Actividad del mes 12, tipo 2', 18, 'finalizada');

INSERT INTO participacion_actividades (id_participacion, id_usuario, id_actividad, puntos_obtenidos) VALUES
(1, 13, 1, 14),
(2, 6, 1, 14),
(3, 10, 1, 14),
(4, 20, 1, 14),
(5, 1, 1, 14),
(6, 5, 1, 14),
(7, 15, 1, 14),
(8, 4, 1, 14),
(9, 7, 1, 14),
(10, 18, 1, 14),
(11, 11, 1, 14),
(12, 19, 1, 14),
(13, 8, 1, 14),
(14, 17, 1, 14),
(15, 12, 1, 14),
(16, 7, 2, 12),
(17, 17, 2, 12),
(18, 16, 2, 12),
(19, 6, 2, 12),
(20, 3, 2, 12),
(21, 5, 2, 12),
(22, 9, 2, 12),
(23, 11, 2, 12),
(24, 13, 2, 12),
(25, 10, 2, 12),
(26, 19, 2, 12),
(27, 2, 2, 12),
(28, 4, 2, 12),
(29, 12, 2, 12),
(30, 18, 2, 12),
(31, 7, 3, 11),
(32, 5, 3, 11),
(33, 1, 3, 11),
(34, 2, 3, 11),
(35, 8, 3, 11),
(36, 16, 3, 11),
(37, 10, 3, 11),
(38, 13, 3, 11),
(39, 15, 4, 15),
(40, 14, 4, 15),
(41, 7, 4, 15),
(42, 13, 4, 15),
(43, 16, 4, 15),
(44, 18, 4, 15),
(45, 5, 5, 7),
(46, 1, 5, 7),
(47, 4, 5, 7),
(48, 14, 5, 7),
(49, 8, 5, 7),
(50, 3, 5, 7),
(51, 13, 5, 7),
(52, 12, 5, 7),
(53, 15, 6, 16),
(54, 2, 6, 16),
(55, 18, 6, 16),
(56, 8, 6, 16),
(57, 4, 6, 16),
(58, 17, 6, 16),
(59, 3, 6, 16),
(60, 13, 6, 16),
(61, 20, 6, 16),
(62, 11, 6, 16),
(63, 9, 6, 16),
(64, 10, 6, 16),
(65, 6, 6, 16),
(66, 20, 7, 15),
(67, 17, 7, 15),
(68, 14, 7, 15),
(69, 15, 7, 15),
(70, 6, 7, 15),
(71, 12, 7, 15),
(72, 18, 7, 15),
(73, 8, 7, 15),
(74, 13, 7, 15),
(75, 5, 7, 15),
(76, 4, 7, 15),
(77, 11, 7, 15),
(78, 16, 8, 8),
(79, 8, 8, 8),
(80, 9, 8, 8),
(81, 15, 8, 8),
(82, 3, 8, 8),
(83, 12, 8, 8),
(84, 5, 8, 8),
(85, 4, 8, 8),
(86, 14, 8, 8),
(87, 6, 8, 8),
(88, 11, 8, 8),
(89, 18, 8, 8),
(90, 2, 8, 8),
(91, 5, 9, 10),
(92, 8, 9, 10),
(93, 13, 9, 10),
(94, 20, 9, 10),
(95, 7, 9, 10),
(96, 2, 9, 10),
(97, 16, 9, 10),
(98, 11, 10, 6),
(99, 18, 10, 6),
(100, 15, 10, 6),
(101, 14, 10, 6),
(102, 2, 10, 6),
(103, 4, 10, 6),
(104, 17, 10, 6),
(105, 7, 10, 6),
(106, 13, 10, 6),
(107, 10, 10, 6),
(108, 1, 10, 6),
(109, 13, 11, 18),
(110, 16, 11, 18),
(111, 1, 11, 18),
(112, 12, 11, 18),
(113, 10, 11, 18),
(114, 20, 11, 18),
(115, 7, 11, 18),
(116, 14, 11, 18),
(117, 9, 11, 18),
(118, 17, 11, 18),
(119, 19, 11, 18),
(120, 4, 11, 18),
(121, 8, 11, 18),
(122, 2, 11, 18),
(123, 14, 12, 15),
(124, 16, 12, 15),
(125, 1, 12, 15),
(126, 13, 12, 15),
(127, 11, 12, 15),
(128, 19, 12, 15),
(129, 15, 12, 15),
(130, 17, 12, 15),
(131, 7, 12, 15),
(132, 15, 13, 8),
(133, 5, 13, 8),
(134, 18, 13, 8),
(135, 1, 13, 8),
(136, 13, 13, 8),
(137, 10, 13, 8),
(138, 20, 13, 8),
(139, 1, 14, 11),
(140, 3, 14, 11),
(141, 14, 14, 11),
(142, 5, 14, 11),
(143, 15, 14, 11),
(144, 19, 14, 11),
(145, 20, 14, 11),
(146, 17, 14, 11),
(147, 7, 14, 11),
(148, 6, 14, 11),
(149, 4, 14, 11),
(150, 8, 14, 11),
(151, 11, 14, 11),
(152, 16, 14, 11),
(153, 10, 14, 11),
(154, 14, 15, 6),
(155, 9, 15, 6),
(156, 3, 15, 6),
(157, 16, 15, 6),
(158, 1, 15, 6),
(159, 12, 15, 6),
(160, 19, 15, 6),
(161, 17, 15, 6),
(162, 6, 15, 6),
(163, 3, 16, 5),
(164, 2, 16, 5),
(165, 1, 16, 5),
(166, 8, 16, 5),
(167, 7, 16, 5),
(168, 14, 16, 5),
(169, 18, 16, 5),
(170, 10, 16, 5),
(171, 8, 17, 16),
(172, 5, 17, 16),
(173, 16, 17, 16),
(174, 4, 17, 16),
(175, 7, 17, 16),
(176, 20, 17, 16),
(177, 12, 17, 16),
(178, 12, 18, 7),
(179, 6, 18, 7),
(180, 4, 18, 7),
(181, 19, 18, 7),
(182, 10, 18, 7),
(183, 2, 18, 7),
(184, 16, 18, 7),
(185, 1, 18, 7),
(186, 5, 18, 7),
(187, 13, 19, 15),
(188, 20, 19, 15),
(189, 7, 19, 15),
(190, 3, 19, 15),
(191, 8, 19, 15),
(192, 2, 19, 15),
(193, 12, 19, 15),
(194, 19, 19, 15),
(195, 5, 19, 15),
(196, 11, 19, 15),
(197, 10, 19, 15),
(198, 15, 19, 15),
(199, 1, 19, 15),
(200, 17, 19, 15),
(201, 14, 20, 14),
(202, 12, 20, 14),
(203, 3, 20, 14),
(204, 17, 20, 14),
(205, 11, 20, 14),
(206, 1, 20, 14),
(207, 20, 20, 14),
(208, 7, 20, 14),
(209, 8, 20, 14),
(210, 2, 20, 14),
(211, 13, 20, 14),
(212, 6, 20, 14),
(213, 19, 20, 14),
(214, 14, 21, 18),
(215, 6, 21, 18),
(216, 17, 21, 18),
(217, 9, 21, 18),
(218, 16, 21, 18),
(219, 8, 21, 18),
(220, 7, 21, 18),
(221, 9, 22, 17),
(222, 11, 22, 17),
(223, 8, 22, 17),
(224, 3, 22, 17),
(225, 20, 22, 17),
(226, 15, 22, 17),
(227, 18, 22, 17),
(228, 4, 22, 17),
(229, 14, 22, 17),
(230, 10, 22, 17),
(231, 19, 22, 17),
(232, 7, 22, 17),
(233, 6, 22, 17),
(234, 1, 22, 17),
(235, 11, 23, 9),
(236, 6, 23, 9),
(237, 16, 23, 9),
(238, 7, 23, 9),
(239, 12, 23, 9),
(240, 13, 23, 9),
(241, 5, 23, 9),
(242, 19, 23, 9),
(243, 14, 23, 9),
(244, 10, 23, 9),
(245, 18, 23, 9),
(246, 9, 23, 9),
(247, 17, 24, 18),
(248, 7, 24, 18),
(249, 3, 24, 18),
(250, 8, 24, 18),
(251, 14, 24, 18);

INSERT INTO fidelizacion (id_fidelizacion, id_usuario, id_perfil, total_puntos, estatus_fidelizacion) VALUES
(1, 1, 4, 154, 'Oro'),
(2, 2, 2, 122, 'Plata'),
(3, 3, 4, 129, 'Plata'),
(4, 4, 4, 147, 'Plata'),
(5, 5, 5, 143, 'Plata'),
(6, 6, 5, 147, 'Plata'),
(7, 7, 2, 224, 'Oro'),
(8, 8, 10, 213, 'Oro'),
(9, 9, 2, 104, 'Plata'),
(10, 10, 10, 149, 'Plata'),
(11, 11, 1, 152, 'Oro'),
(12, 12, 2, 141, 'Plata'),
(13, 13, 3, 185, 'Oro'),
(14, 14, 2, 182, 'Oro'),
(15, 15, 3, 140, 'Plata'),
(16, 16, 9, 156, 'Oro'),
(17, 17, 4, 178, 'Oro'),
(18, 18, 4, 125, 'Plata'),
(19, 19, 7, 138, 'Plata'),
(20, 20, 9, 154, 'Oro');

CREATE VIEW v_DesempenoColaboradores AS
SELECT
    CONCAT(u.nombre, ' ', u.apellido) AS nombre_completo,
    u.cargo,
    u.salario,
    u.fecha_ingreso,
    COALESCE(SUM(pa.puntos_obtenidos), 0) AS total_puntos_fidelizacion_acumulados,
    CASE
        WHEN COUNT(pa.id_actividad) > 0 THEN ROUND(AVG(pa.puntos_obtenidos), 2)
        ELSE 0
    END AS promedio_puntos_por_actividad,
    CASE
        WHEN COALESCE(SUM(pa.puntos_obtenidos), 0) > 500 THEN 'Excelente'
        WHEN COALESCE(SUM(pa.puntos_obtenidos), 0) BETWEEN 200 AND 500 THEN 'Bueno'
        ELSE 'Regular'
    END AS estado_fidelizacion,
    DATEDIFF(CURRENT_DATE, (
        SELECT MAX(l.fecha_hora_login)
        FROM login l
        WHERE l.id_usuario = u.id_usuario AND l.estado_login = 'exitoso'
    )) AS dias_desde_ultimo_login
FROM usuarios u
LEFT JOIN participacion_actividades pa ON u.id_usuario = pa.id_usuario
GROUP BY u.id_usuario;

-- Vista del desempeño
SELECT * FROM v_DesempenoColaboradores;

CREATE OR REPLACE VIEW v_actividadesPorPerfil AS
SELECT
    p.nombre_perfil,
    p.descripcion_perfil,
    COUNT(DISTINCT u.id_usuario) AS cantidad_usuarios_con_este_perfil,
    COUNT(pa.id_participacion) AS total_actividades_participadas_por_perfil,
    ROUND(
        IF(COUNT(DISTINCT u.id_usuario) > 0,
           SUM(pa.puntos_obtenidos) / COUNT(DISTINCT u.id_usuario),
           0),
        2
    ) AS promedio_puntos_por_usuario_en_este_perfil,
    ROUND(
        (COUNT(pa.id_participacion) / (SELECT COUNT(*) FROM participacion_actividades)) * 100,
        2
    ) AS porcentaje_participacion_total
FROM perfiles p
LEFT JOIN usuarios u ON p.id_perfil = u.id_perfil
LEFT JOIN participacion_actividades pa ON u.id_usuario = pa.id_usuario
GROUP BY p.id_perfil;

-- Vista de actividades por perfil
SELECT * FROM v_actividadesPorPerfil;

CREATE OR REPLACE VIEW v_historialLoginDetallado AS
SELECT
    u.nombre AS nombre_usuario,
    u.apellido AS apellido_usuario,
    u.cargo AS cargo_usuario,
    l.fecha_hora_login,
    l.estado_login,
    TIMESTAMPDIFF(SECOND,
        LAG(l.fecha_hora_login) OVER (PARTITION BY l.id_usuario ORDER BY l.fecha_hora_login),
        l.fecha_hora_login
    ) AS tiempo_desde_anterior_login
FROM login l
JOIN usuarios u ON l.id_usuario = u.id_usuario;

-- Vista de historial de login
SELECT * FROM v_historialLoginDetallado;

